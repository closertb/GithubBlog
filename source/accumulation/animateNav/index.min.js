function cac(t,i){for(var e=[],s=2*PI/i,o=0;o<i;o++)e.push({x:t*sin(s*o),y:-1*t*cos(s*o)});return e}function drawBg(t,i){this.stars=[],this.mets=[],this.option={starCount:50,starMinSize:3,starMaxSize:6,starMinLux:.1,starMaxLux:.8,meteorCount:3,meteorAngle:45,meteorMaxLux:.8,meteorMoveSpeed:8,meteorFadeSpeed:.001,meteorMaxSize:1.5,meterTime:1e3},this.option.count=0,this.append=t;var e=document.createElement("canvas");return e&&e.getContext?(this.option.width=t.offsetWidth,this.option.height=t.offsetHeight,t.offsetWidth&&t.offsetHeight?(this.initOption(i,this.option),this.init(),void update(this.option,this.stars,this.mets)):(alert("画布宽高不能为0"),!1)):(alert("浏览器版本太低"),!1)}function update(t,i,e){if(t.starCount){t.count=(t.count+1)%t.starCount;var s=i[t.count];s.update(),t.ctx.clearRect(s.position.x,s.position.y,s.domSize,s.domSize),t.ctx.drawImage(s.canvas,s.position.x,s.position.y)}e.forEach(function(i){i.setStart&&(t.ctx.clearRect(i.position.x,i.position.y,i.width,i.height),(i.position.x+i.width<=0||i.position.y>1950||i.alpha<0)&&(i.position.x=i.xStart+100*random(),i.position.y=200*random(),i.setAlphaDefault()),i.position.x=i.position.x-i.moveDis,i.position.y=i.position.y+i.moveDisHight,i.update(),t.ctx.drawImage(i.canvas,i.position.x,i.position.y))}),requestAnimationFrame(function(){update(t,i,e)})}function Star(t,i){this.position=t,this.size=random()*i.maxSize+i.minSize,this.domSize=3*this.size,this.maxLux=i.minLux+i.maxLux,this.minLux=i.minLux,this.canvas=document.createElement("canvas"),this.canvas.width=this.domSize,this.canvas.height=this.domSize,this.alpha=random()*(i.maxLux-.3)+.35,this.ctx=this.canvas.getContext("2d"),this.draw()}function Meteor(t,i){this.position=t,this.xStart=t.x,this.size=random()*(i.size-.7)+.7,this.radius=this.size,this.rotateAngle=-1*i.angle,this.moveDis=i.moveSpeed,this.moveDisHight=this.moveDis*tan(-1*this.rotateAngle),this.setStart=!1,this.canvas=document.createElement("canvas"),this.width=this.canvas.width=150*this.size;var e=this.size>1?20*this.size:20;this.height=this.canvas.height=e+this.width*sin(i.angle),this.maxLux=i.maxLux,this.alpha=i.maxLux,this.fedeSpeed=i.fadeSpeed,this.ctx=this.canvas.getContext("2d"),this.draw(!0)}var PI=Math.PI,sin=Math.sin,cos=Math.cos,tan=Math.tan,random=Math.random;drawBg.create=function(t,i){return new drawBg(t,i)},drawBg.prototype={initOption:function(t,i){t&&(t&&Object.keys(t).forEach(function(e){i[e]&&(i[e]=t[e])}),i.starCount&&i.meteorCount?(this.starOption={minSize:i.starMinSize,maxSize:i.starMaxSize-i.starMinSize,minLux:i.starMinLux,maxLux:i.starMaxLux-i.starMinLux},this.meteorOption={size:i.meteorMaxSize,angle:PI*i.meteorAngle/180,maxLux:i.meteorMaxLux,moveSpeed:i.meteorMoveSpeed,fadeSpeed:i.meteorFadeSpeed}):console.error("星星数量和流星属性不能同时为空"))},init:function(){function t(){if(!(++n>e.option.meteorCount)){var i=e.mets[n-1];e.option.ctx.drawImage(i.canvas,i.position.x,i.position.y),i.setStart=!0,setTimeout(function(){t()},e.option.meterTime)}}var i=document.createElement("canvas"),e=this;i.width=this.option.width,i.height=this.option.height,this.option.ctx=i.getContext("2d");for(var s=0;s<this.option.starCount;s++){var o=new Star({x:random()*this.option.width,y:random()*this.option.height},this.starOption);this.stars.push(o),this.option.ctx.drawImage(o.canvas,o.position.x,o.position.y)}for(s=0;s<this.option.meteorCount;s++){var a=400+600*s+100*random(),h=new Meteor({x:a=a>this.option.width?a%this.option.width:a,y:200*random()},this.meteorOption);this.mets.push(h)}this.append.appendChild(i);var n=0;t()}},Star.prototype={draw:function(){this.color="rgba(255,255,255,"+this.alpha+")",this.ctx.shadowBlur=.8*this.size,this.ctx.shadowColor=this.color,this.ctx.beginPath(),this.ctx.fillStyle=this.color,this.ctx.arc(this.domSize/2,this.domSize/2,.4*this.size,0,2*PI),this.ctx.fill()},update:function(){this.alpha=(this.alpha+.1)%this.maxLux+this.minLux,this.ctx.clearRect(0,0,this.domSize,this.domSize),this.draw()}},Meteor.prototype={draw:function(t){this.color="rgba(255,255,255,"+this.alpha+")",t&&(this.ctx.translate(5,this.height-8),this.ctx.rotate(this.rotateAngle));var i=this.ctx.createLinearGradient(0,0,this.canvas.width,-1*this.canvas.height);i.addColorStop(0,"rgba(255,255,255,"+this.alpha+")"),i.addColorStop(1,"rgba(255,255,255,"+.1*this.alpha+")"),this.ctx.shadowBlur=.4*this.size,this.ctx.shadowColor=i,this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.arc(3*this.size+1,-4,this.radius,PI/2,3*PI/2,!1),this.ctx.lineTo(this.width-4,-4),this.ctx.lineTo(3*this.size+1,2*this.radius-4),this.ctx.fill()},setAlphaDefault:function(){this.alpha=this.maxLux},update:function(){this.alpha=this.alpha-this.fedeSpeed,this.ctx.clearRect(0,0,this.width,-1*this.height),this.draw(!1)}},drawBg.create(document.getElementById("canvasPoint"),{starCount:200,meteorCount:3,meterTime:1e3});