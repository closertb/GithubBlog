---
title: 给组件库加个鸡腿
date: 2019-06-25 23:34:28
tags:
---

为了工作，也为了长点见识，费心费力捣腾了一个[组件库antd-doddle][1]，还是有成长的，总结都写了两篇，收获还是有的，如果你喜欢听故事：
 - [从dist到es：发一个NPM库，我蜕了一层皮][2]
 - [从24m到1m, 一个react+antd后台系统构建打包历程][3]
 - [组件文档地址][4]

## 为什么要鸡腿  
组件库写出来了，项目也陆陆续续用了，但组里小伙伴用起来，总是要问这个配置怎么写，这个组件怎么用，手把手教学，总不能让小伙伴都去看源码实现吧，所以自己一发狠，用一整晚，写了一篇[组件库使用指南][5]，基本就是下图这个风格，示例代码有了，输入输出配置有了，输出效果有了，临时解决了一些问题，但随着业务膨胀，使用人员逐步增多，这种静态文档已经不能满足需求了。
![clipboard.png][11] 

## 鸡腿是要解决什么
不是解决解饿，是让生活更富有。这一篇[组件库使用指南][6],该有的内容都有，但问题还是很多：
 - 整个组件库就一个指南，特别长，没有很好的分类，无法快速找到自己的所需；
 - 由于篇幅和实现难度，组件库demo太单一，覆盖面太小；
 - 组件库没有用例，每一次修改，没有demo用例来快速测试，发布了才测试，有比较大的风险，容易造成频繁发版；
 - 自己又想捣腾了；
 
## 鸡腿原配方
市面上有很多成熟的方案，推荐比较多的就是[Docz][7]，但试了一下，使用起来并没有介绍的那么好用，规范太死板，复杂demo编写实现困难，所以最后还是采用了antd的组件库方案[Bisheng][8]，毕竟是完美兼容react，与antd的组件库。
花了一两天折腾了一下Bisheng，发现其还是很好用的，库更多是作为一个路由适配的数据流容器(RenderProps)，可配置性很高，UI完全由使用人自己定制（官方称其为主题），库本身提供一个简易的主题[Bisheng-Theme-One][9]。
只要搞懂了数据长什么样，编写一个展示性组件就显得不是那么难了，从下图看看（图片路由：http://localhost:8090/guide/introduce）：
![clipboard.png][12]
 - data：是所有的文档信息，和你的文档结构具有强匹配，可以用此数据做文档菜单的数据源；
 - pageData：是当前路由，匹配出的文档内容，也就是你正文要显示的内容；
 - themeConfig：是一个主题定制对象，你想自己定义的变量，都可以在这个对象中增加
 - utils：toReactComponent是暴露出来的一个常用方法  
当然，每一个主题有一个组件路由适配方案，需要在主题根目录下的index.js进行配置，一张图胜所有：
![clipboard.png][13]
左边的配置会告诉bisheng插件，在匹配到某个路由时去调用相应的组件。组件的具体实现，请[参看源码][10]，这里不再一一分析。

## 鸡腿的味道
总的来说，鸡腿的味道还是很香的，菜单清晰，组件文档一目了然，还配有相应的demo，上两张高清大图感受一下。  
![clipboard.png][14] 
![clipboard.png][15]

捣腾到此为止，明天开始专心复习【捂脸】。

  [1]: https://www.npmjs.com/package/antd-doddle
  [2]: http://closertb.site/2019/02/%E4%BB%8Edist%E5%88%B0es%EF%BC%9A%E5%8F%91%E4%B8%80%E4%B8%AANPM%E5%BA%93%EF%BC%8C%E6%88%91%E8%9C%95%E4%BA%86%E4%B8%80%E5%B1%82%E7%9A%AE/
  [3]: http://closertb.site/2019/03/%E4%B8%80%E4%B8%AAreact-antd%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E6%89%93%E5%8C%85%E5%8E%86%E7%A8%8B%E2%80%99/
  [4]: http://doc.closertb.site/guide/introduce
  [5]: https://www.npmjs.com/package/antd-doddle/v/0.0.12
  [6]: https://www.npmjs.com/package/antd-doddle/v/0.0.12
  [7]: https://www.docz.site/
  [8]: https://github.com/benjycui/bisheng
  [9]: https://github.com/benjycui/bisheng/tree/master/packages/bisheng-theme-one
  [10]: https://github.com/closertb/antd-doddle
  [11]: https://image-static.segmentfault.com/249/715/2497158320-5d121b8f2147a_articlex  
  [12]:https://image-static.segmentfault.com/239/229/2392291735-5d12340fd25b9_articlex
  [13]:https://image-static.segmentfault.com/386/881/3868811459-5d123b09033de_articlex
  [14]:https://image-static.segmentfault.com/108/862/1088624792-5d123cc3b0a83_articlex
  [15]:https://image-static.segmentfault.com/562/649/562649438-5d123cf5a6e78_articlex